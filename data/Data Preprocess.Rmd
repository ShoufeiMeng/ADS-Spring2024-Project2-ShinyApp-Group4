---
title: "Data Preprocess"
output: html_document
date: "2024-02-15"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Hazard Mitigation Assistance Mitigated Properties, Hazard Mitigation Assistance Projects: This dataset contains the properties that were mitigated by projects funded under the Hazard Mitigation Assistance (HMA) grant programs. FEMA administers three programs that provide funding for eligible mitigation planning and projects that reduces disaster losses and protect life and property from future disaster damages. The three programs are the Hazard Mitigation Grant Program (HMGP), Flood Mitigation Assistance (FMA) grant program, and Building Resilient Infrastructure and Communities (BRIC) grant program. This dataset also contains data from the HMA grant programs that were eliminated by the Disaster Recovery Reform Act of 2018 (Pre-Disaster Mitigation grant program (PDM)), the Biggert Water Flood Insurance Reform Act of 2012 (Repetitive Flood Claims (RFC) grant program, and Severe Repetitive Loss (SRL) grant program). For more information on the Hazard Mitigation Assistance grant programs, please visit: https://www.fema.gov/grants/mitigation .

This dataset contains mitigated property information from FEMA’s mitigation grant systems and is subject to a small percentage of human error. The dataset contains properties by project identifier, city, zip code, county, state and region and does not contain any Personally Identifiable Information (PII). The dataset can be joined to the OpenFEMA Hazard Mitigation Assistance Funded Project dataset by the Project Identifier field. Not all projects in the Hazard Mitigation Assistance Funded Project dataset will have mitigated properties (e.g., Planning and Management Cost projects). The financial information is derived from FEMA’s mitigation grant systems, not FEMA's official financial systems. Due to differences in reporting periods, status of obligations and how business rules are applied, this financial information may differ slightly from official publication on public websites such as usaspending.gov; this dataset is not intended to be used for any official federal financial reporting.


Load Data

```{r read data}
v1 <- read.xlsx("/Users/janicemeng/Desktop/Columbia/Semester2/Applied DS/FemaWebDisasterDeclarations.xlsx")
v2 <- read.xlsx("/Users/janicemeng/Desktop/Columbia/Semester2/Applied DS/DisasterDeclarationsSummaries.xlsx")

```

Inspect the Data
```{r}
# View the first few rows of the data
head(v1)

# Summary statistics for each column
summary(v1)

# Structure of the data
str(v1)
```

Clean Column Names
```{r}
# Clean column names (if needed)
install.packages("janitor")
library(janitor)
v1 <- clean_names(v1)


```
Handle Missing Values
```{r}
library(dplyr)
library(tidyverse)
na_count <- v1 %>%
  summarise_all(~sum(is.na(.)))

print(na_count)
colnames(v1)

v1_sel <- v1 %>%
  select(disastername, statecode, declarationtype, disasternumber)

colnames(v2)
v2_sel <- v2 %>% 
  select(state, disasterNumber, incidentType,incidentBeginDate,incidentEndDate, designatedArea)
table(v1_sel$disasterNumber)

data_frame_distinct <- v1_sel %>% distinct(disasterNumber, .keep_all = TRUE)

library(dplyr)
combined <- inner_join(v1_sel, v2_sel, by = "disasterNumber")


```

# Handle missing value in v1 dataset

```{r}
# Check for missing values
sum(is.na(v1))

# If appropriate, you can remove rows with missing values
v1 <- na.omit(v1)
summary(v1)
```


# Handle missing value in combined dataset
```{r}
na_count <- combined %>%
  summarise_all(~sum(is.na(.)))

print(na_count)

head(combined,5)
combined_df <- na.omit(combined)

head(combined,5)
str(combined_df)
library(writexl)
write_xlsx(combined_df, path = "/Users/janicemeng/Desktop/Columbia/Semester2/Applied DS/Project2/combined_df.xlsx")

```

```{r}
table(combined_df$incidentType)
table(combined_df$stateCode)
```

# Shiny app set up
```{r}
knitr::opts_chunk$set(fig.width=12, fig.height=8, fig.path='figs/',
                      echo=T, warning=FALSE, message=FALSE)

library(dtplyr)
library(dplyr)
library(DT)
library(lubridate)


library(shiny)
library(devtools)
library(choroplethrZip)
```

```{r}

```
## 2.1 Create an app
***

### Step 1: Store ui.R and server.R in the same folder.

```{r,echo=FALSE}
fluidPage(
  tabsetPanel(
    tabPanel('server.R',
             code('library(shiny)
shinyServer(function(input, output) {
  output$plot=renderPlot({
    hist(faithful$eruptions, probability = TRUE, breaks = as.numeric(input$n_breaks),
         xlab = "Duration (minutes)", main = "Geyser eruption duration")
    
    dens <- density(faithful$eruptions, adjust = input$bw_adjust)
    lines(dens, col = "blue")
  })
})')),
    tabPanel('ui.R',
             code('
shinyUI(
fluidPage(
  sidebarPanel(
    selectInput("n_breaks", label = "Number of bins:",
                choices = c(10, 20, 35, 50), selected = 20),
    
    sliderInput("bw_adjust", label = "Bandwidth adjustment:",
                min = 0.2, max = 2, value = 1, step = 0.2)
  ),
  mainPanel(
    plotOutput("plot")
  )
))
                                    '))
  )
)




```



